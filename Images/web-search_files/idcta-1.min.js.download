define("idcta-v2/logger",[],function(){var e={};return e.logCaughtError=function(e){window.console&&e.message&&console.log(e)},e.logMessage=function(e){document.cookie.match(new RegExp("ckns_debugtoken=([^;]+)"))&&(window.tokenRefeshLog=window.tokenRefeshLog||[],window.tokenRefeshLog.push(e))},e}),define("idcta-v2/optional",["idcta-v2/logger"],function(e){var t={};return t.load=function(t,r,n){r([t],n,function(t){var r=t.requireModules&&t.requireModules[0];e.logCaughtError("Could not load optional module: "+r),n(null)})},t}),define("idcta-v2/istats",["idcta-v2/optional!istats-1"],function(e){return e||{getSite:function(){},_getLabels:function(){return{app_name:"",prod_name:""}}}}),define("idcta-v2/apiUtils",["idcta-v2/es6-promise","idcta-v2/istats","idcta-v2/logger"],function(e,t,r){function n(e,t){var r=t.substring(0,t.indexOf("=")+1);if(e.indexOf(r)>-1)return e;var n=e.split("#"),o=e.indexOf("?")>-1?"&":"?";return n.length>1?n[0]+o+t+"#"+n[1]:e+o+t}function o(){try{var e=t.getSite();if(e)return e.split(" ").shift();var n=t._getLabels();if(n){const o=n.app_name||n.prod_name;return o?o.split(" ").shift():""}return""}catch(e){r.logCaughtError(e)}}function i(){this.promise={},this.resolver={}}var s={};return s.verifyEndpointUrl=function(e,t){try{!1!==t&&(t=!0);if(/https?:\/\/(((www|ssl)(\.int|\.test|\.stage)?)|(pal\.sandbox\.dev))\.bbc\.(co\.uk|com)/.test(e))return/(\.com|\.co\.uk)\/.+/.test(e)&&(e=e.split(/(\.com|\.co\.uk)\/.+/)[0]+e.split(/(\.com|\.co\.uk)\/.+/)[1]),e;var n="";"https"==e.slice(0,5)?(n+=(t?"https://":"")+"ssl.",e.indexOf(".sandbox.")>-1&&(n+="sandbox.dev.")):(n+=t?"http://":"",e.indexOf(".sandbox.")>-1?n+="pal.sandbox.dev.":n+="www.");for(var o=["int","test","stage"],i=0;i<o.length;i++)e.indexOf("."+o[i]+".")>-1&&(n+=o[i]+".");return/\.co\.uk/.test(e)?n+="bbc.co.uk":n+="bbc.com",n}catch(e){r.logCaughtError(e)}},s.alignTldWithHostname=function(e,t){try{var n=t||window.location.hostname,o=n.split(/(\.com|\.co\.uk)$/)[1],i=e.split(/(\.com|\.co\.uk)\/.+/)[1];return i!==o&&void 0!==o&&(e=e.replace(i,o)),e}catch(e){r.logCaughtError(e)}},s.appendProductToConfig=function(e){var t="",r="",i=o();return void 0!==i&&""!==i&&(t="userOrigin="+i,r="context="+i,e.register_url=n(e.register_url,t),e.register_url=n(e.register_url,r),e.signin_url=n(e.signin_url,t),e.signin_url=n(e.signin_url,r),e.signout_url=n(e.signout_url,t),e.signout_url=n(e.signout_url,r),e.status_url=n(e.status_url,t),e.status_url=n(e.status_url,r),e.settings_url=n(e.settings_url,t),e.settings_url=n(e.settings_url,r)),e},s.appendProductToCtaElement=function(e){var t="",r="",i=e.getAttribute("href");if(i&&(-1===i.indexOf("userOrigin=")||-1===i.indexOf("context="))){var a=o();if(void 0!==a&&""!==a){t="userOrigin="+a,r="context="+a;var c=e.getAttribute("href"),u=s.parseUrl(c);if(u){var g=(s.parseQueryString(u.search),u.pathname);-1===u.pathname.indexOf("/")&&(g="/"+u.pathname),e.setAttribute("href",u.protocol+"//"+u.host+g+n(n(u.search,t),r)+u.hash)}}}},s.addQueryParameter=n,s.Promise=function(){try{return"undefined"!=typeof Promise?Promise:e.Promise}catch(e){r.logCaughtError(e)}}(),s.loadUrlInHiddenIframe=function(e,t,n){try{return new s.Promise(function(o,i){r.logMessage('Creating iframe {src: "'+e+'", timeout: '+t+(n?', expectedPostMessages: ["'+n.join('", "')+'"]}':"}"));var a=document.createElement("iframe");a.scrolling="no",a.frameborder="0",a.width="0px",a.height="0px",a.border="0px",a.style.display="none",a.style.frameBorder="0px",a.style.borderStyle="none";var c=null,u=function(e){var t=e.message?"message":"data";return e.origin.match(/\.bbc\.(co\.uk|com)(:[0-9]+)*$/)&&-1!=n.indexOf(e[t])?(r.logMessage('Iframe received message "'+e[t]+'", resolving'),g(),o(e[t])):void r.logMessage('Iframe received unexpected message "'+e[t]+'", ignoring')},g=function(){c&&clearTimeout(c),n&&s.removeEventListener("message",u),document.body.removeChild(a)};n?s.addEventListener("message",u):a.onload=function(){return r.logMessage('Iframe with src "'+e+'" loading complete'),g(),o()},t&&(c=setTimeout(function(){return r.logMessage("Iframe with src "+e+" timed out after "+t+" milli seconds"),g(),i()},t)),a.src=e,document.body.appendChild(a)})}catch(e){r.logCaughtError(e)}},s.addEventListener=function(e,t,r){s.addEventListenerTo(window,e,t,r)},s.addEventListenerTo=function(e,t,n,o){try{return e.addEventListener?e.addEventListener(t,n,o):(t="message"==t?"onmessage":t,e.attachEvent(t,n))}catch(e){r.logCaughtError(e)}},s.removeEventListener=function(e,t){s.removeEventListenerFrom(window,e,t)},s.removeEventListenerFrom=function(e,t,n){try{return e.removeEventListener?e.removeEventListener(t,n):(t="message"==t?"onmessage":t,e.detachEvent(t,n))}catch(e){r.logCaughtError(e)}},s.getEnvFromUrl=function(){try{var e=window.location.href;return e.indexOf(".sandbox.")>-1?".sandbox.dev":e.indexOf(".int.")>-1?".int":e.indexOf(".test.")>-1?".test":e.indexOf(".stage.")>-1?".stage":""}catch(e){r.logCaughtError(e)}},s.parseUrl=function(e){try{var t=document.createElement("a");return t.href=e,t.query=t.search?s.parseQueryString(t.search):{},t}catch(e){r.logCaughtError(e)}},s.parseQueryString=function(e){try{"?"===e.charAt(0)&&(e=e.substring(1));for(var t={},n=e.split("&"),o=0;o<n.length;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]||"")}return t}catch(e){r.logCaughtError(e)}},s.timestampInFuture=function(e){try{return e>(new Date).getTime()}catch(e){r.logCaughtError(e)}},s.timestampExpired=function(e){try{return e<(new Date).getTime()}catch(e){r.logCaughtError(e)}},s.generateFutureTimestamp=function(e){try{e=e||36e5;var t=new Date;return t.setTime(t.getTime()+e),t.getTime()}catch(e){r.logCaughtError(e)}},r.logCaughtError=function(e){window.console&&e.message&&console.log(e)},r.logMessage=function(e){document.cookie.match(new RegExp("ckns_debugtoken=([^;]+)"))&&(window.tokenRefeshLog=window.tokenRefeshLog||[],window.tokenRefeshLog.push(e))},i.prototype.isSet=function(e){return void 0!==this.resolver[e]},i.prototype.set=function(e,t){this.resolver[e]=t},i.prototype.get=function(e){function t(){var t=r.resolver[e];return"function"!=typeof t?s.Promise.reject(new TypeError("Promise resolver "+t+" is not a function for key "+e)):new s.Promise(t).then(function(t){return delete r.promise[e],delete r.pending,t},function(t){throw delete r.promise[e],delete r.pending,t})}var r=this;return this.promise[e]?this.promise[e]:this.pending?(this.promise[e]=this.pending.then(t,t),this.pending=this.promise[e],this.promise[e]):(this.promise[e]=t(),this.pending=this.promise[e],this.promise[e])},s.PromisePool=i,s}),define("idcta-v2/id-config",["idcta-v2/config","idcta-v2/translations","idcta-v2/apiUtils","idcta-v2/logger"],function(e,t,r,n){var o,i=window.location.host.split(".");o="co"===i[i.length-2]&&"uk"===i[i.length-1]?i[i.length-3]+".co.uk":i[i.length-2]+"."+i[i.length-1],e=r.appendProductToConfig(e);var s={announce_url:r.alignTldWithHostname(e.announce_url),"bbcid-v5":e["bbcid-v5"],child_parent_linking_url:e.child_parent_linking_url,"id-availability":e["id-availability"],identity:{cookieAgeDays:e.identity.cookieAgeDays,accessTokenCookieName:e.identity.accessTokenCookieName,idSignedInCookieName:e.identity.idSignedInCookieName},identityTokenExchangeUrl:r.alignTldWithHostname(e.identityTokenExchangeUrl),privacy_settings_url:e.privacy_settings_url,ptrt:window.location.href,register_url:r.alignTldWithHostname(e.register_url),settings_url:e.settings_url,signin_url:r.alignTldWithHostname(e.signin_url),signout_url:e.signout_url,status_url:e.status_url,tld:o,tokenRefresh:e.tokenRefresh||!1,tokenRefresh_signout_url:r.alignTldWithHostname(e.tokenRefresh_signout_url),tokenRefresh_url:r.alignTldWithHostname(e.tokenRefresh_url),translation_signedin:t.translation_statusbar_signedin,translation_signedout:t.translation_statusbar_signedout};return s.getConfigAsync=function(){try{return{then:function(e){return e(s)}}}catch(e){n.logCaughtError(e)}},s.getConfig=function(){return s},s}),define("idcta-v2/idCookie",["idcta-v2/id-config","idcta-v2/logger"],function(e,t){function r(){try{return a?(a.refreshCookie(),a):a=new s}catch(e){t.logCaughtError(e)}}function n(e){try{a=e}catch(e){t.logCaughtError(e)}}function o(e){try{var t=window.atob(e),r=t.lastIndexOf("}"),n=t.substring(0,r+1);return JSON.parse(n)}catch(e){return null}}function i(e,r,n,o){try{r=r||"";var i="";if(n){var s=new Date;s.setTime(s.getTime()+n),i="Expires="+s.toUTCString()+"; "}r=o?window.btoa(r):r,document.cookie=e+"="+r+"; "+i+"Domain="+g+"; Path=/"}catch(e){t.logCaughtError(e)}}function s(){function e(){var e=new RegExp(l+"=([\\w]+)"),t=document.cookie.match(e);if(!t)return void a();var r=o(t[1]);if(!r||!n(r)||s(r))return void a();c.valid=!0,c.displayname=r.dn,c.timestamp=r["jwt-exp"]}function r(){var e=c.cookieAgeDays*u;return(new Date).getTime()-c.timestamp>=e}function n(e){return e.hasOwnProperty("ps")&&e.hasOwnProperty("jwt-exp")&&e.hasOwnProperty("tkn-exp")&&(e.hy||e.hasOwnProperty("ses-exp"))}function s(e){var t=(new Date).getTime();return(e["jwt-exp"]||0)<=t}function a(){c.valid=!1,c.id="",c.username="~",c.displayname="",c.timestamp=""}var c=this;this.valid=!1,this.id="",this.username="~",this.displayname="",this.timestamp="",this.cookieAgeDays=d,this.isIdv5On=!0,this.refreshCookie=function(){try{e()}catch(e){t.logCaughtError(e)}},this.hasCookie=function(){try{return r()&&a(),c.valid}catch(e){t.logCaughtError(e)}},this.hasAccessTokenExpired=function(){try{var e=this.getUserDetailsFromCookie();if(!e)return!0;var r=(new Date).getTime();return(e["tkn-exp"]||0)<=r}catch(e){t.logCaughtError(e)}},this.hasJwtTokenExpired=function(){try{var e=this.getUserDetailsFromCookie();if(!e)return!0;var r=(new Date).getTime();return(e["jwt-exp"]||0)<=r}catch(e){t.logCaughtError(e)}},this.isHybridApp=function(){try{var e=this.getUserDetailsFromCookie();return!!e&&(e.hy||!1)}catch(e){t.logCaughtError(e)}},this.getError=function(){try{var e=this.getUserDetailsFromCookie();return e?e.ec||null:null}catch(e){t.logCaughtError(e)}},this.getIdFromCookie=function(){try{var e=this.getUserDetailsFromCookie();return e?e.ps:null}catch(e){t.logCaughtError(e)}},this.getHidFromCookie=function(){return this.getCookie(f)},this.isPersonalisationEnabled=function(){try{var e=this.getUserDetailsFromCookie();return e&&e.ep}catch(e){return t.logCaughtError(e),!1}},this.getUserDetailsFromCookie=function(){try{if(!this.hasCookie())return null;var e=new RegExp(l+"=([\\w]+)"),r=document.cookie.match(e);if(!r)return null;var i=decodeURIComponent(r[1]).split("|"),s=o(i.toString());return s&&n(s)?s:null}catch(e){t.logCaughtError(e)}},this.getNameFromCookie=function(){try{return this.hasCookie()&&(c.displayname&&""!==c.displayname)?c.displayname.replace(/\+/g," "):null}catch(e){t.logCaughtError(e)}},this.getAccessToken=function(){try{if(!this.hasCookie())return null;var e=new RegExp(h+"=([^;]*)"),r=document.cookie.match(e);return null!==r?r[1]:null}catch(e){t.logCaughtError(e)}},this.getCookie=function(e,r){try{var n=new RegExp(e+"=([^\\s;]*)"),i=document.cookie.match(n);if(!i)return null;if(!0!==r)return i[1];return o(decodeURIComponent(i[1]))}catch(e){t.logCaughtError(e)}},this.setCknsIdCookieProperty=function(e,r){try{var n=this.getUserDetailsFromCookie();if(!n)return;r?n[e]=r:delete n[e];var o=n["jwt-exp"]?n["jwt-exp"]:u*d;i(l,JSON.stringify(n),o,!0)}catch(e){t.logCaughtError(e)}},this.unsetCookie=function(e){try{document.cookie=e+"=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Domain="+g+"; Path=/"}catch(e){t.logCaughtError(e)}},function(){e()}()}var a,c={},u=864e5,g=(e.tld,e.tld),l=e.identity&&e.identity.idSignedInCookieName?e.identity.idSignedInCookieName:"ckns_id",d=e.identity&&e.identity.cookieAgeDays?e.identity.cookieAgeDays:730,h=e.identity&&e.identity.accessTokenCookieName?e.identity.accessTokenCookieName:"ckns_atkn",f="ckpf_sylphid";return c.getInstance=r,c.setInstance=n,c}),define("idcta-v2/tokenRefresh",["idcta-v2/id-config","idcta-v2/idCookie","idcta-v2/apiUtils","idcta-v2/logger"],function(e,t,r,n){function o(o,a){var c=t.getInstance(),u=new Date,l=u.getTime();n.logMessage("Token refresh "+l+" starting ["+u+"]");try{if(!c.hasCookie())return n.logMessage("Token refresh "+l+" rejected as ckns_id cookie is missing, invalid or expired!"),r.Promise.reject(new i);if(c.isHybridApp())return n.logMessage("Token refresh "+l+" rejected, hybrid app detected"),r.Promise.reject(new s);var y=c.getError();if(y&&r.timestampInFuture(y.retryAfter))return n.logMessage("Token refresh "+l+" rejected as there is error in cookie { code: "+y.code+', message: "'+y.message+'", retryAfter: '+y.retryAfter+"}"),r.Promise.reject(y);if(!0!==o&&!c.hasAccessTokenExpired())return n.logMessage("Token refresh "+l+" resolved without action as token has not expired"),r.Promise.resolve();if(o&&n.logMessage("Token refresh "+l+" forced even though token may not have expired"),h.isSet(a))n.logMessage("Token refresh "+l+" reusing existing promise in progress for "+a);else{var C=e.tokenRefresh_url;C=a?r.alignTldWithHostname(C,a):C,C=r.addQueryParameter(C,"tr="+l);var E=e.announce_url||"";E=a?r.alignTldWithHostname(E,a):E,E=r.addQueryParameter(E,"tr="+l),E=encodeURIComponent(E),C=C.replace(e.announce_url,E),h.set(a,function(e,t){r.loadUrlInHiddenIframe(C,g,d).then(e,t)})}var w=function(){n.logMessage("Token refresh "+l+" complete.")},_=function(e){throw n.logMessage("Token refresh "+l+" failed with error { code: "+e.code+', message: "'+e.message+'", retryAfter: '+e.retryAfter+"}"),e};return h.get(a).then(null,f).then(m).then(p).then(null,v).then(null,k).then(w,_)}catch(e){n.logCaughtError(e)}}function i(){this.code=401,this.message="Invalid session"}function s(){this.code=401,this.message="Unauthorised"}function a(e){this.code=500,this.message="Unauthorised",this.retryAfter=e||(new Date).getTime()+l}function c(e){this.code=408,this.message="Request timeout",this.retryAfter=e||(new Date).getTime()+l}function u(e){h=e}var g=15e3,l=15e3,d=["bbcidv5_token_success","error","invalid"],h=new r.PromisePool,f=function(){var r=(new Date).getTime()+(e.tokenRefresh?l:36e5),o=new c(r);throw t.getInstance().setCknsIdCookieProperty("ec",o),n.logMessage("Token refresh - timed out, error added to cookie, if cookie exists { code: "+o.code+', message: "'+o.message+'", retryAfter: '+o.retryAfter+"}"),o},m=function(e){if("invalid"!==e)return e;throw n.logMessage("Token refresh - invalid session error"),new i},p=function(e){if("bbcidv5_token_success"===e)return e;var r=t.getInstance().getError();throw r?n.logMessage("Token refresh - unsuccessful, throwing error from cookie { code: "+r.code+', message: "'+r.message+'", retryAfter: '+r.retryAfter+"}"):n.logMessage("Token refresh - unsuccessful, no error found in cookie"),r},v=function(e){if(e)throw e;throw e=new a,t.getInstance().setCknsIdCookieProperty("ec",e),n.logMessage("Token refresh - Internal service error, error added to cookie, if cookie exists { code: "+e.code+', message: "'+e.message+'", retryAfter: '+e.retryAfter+"}"),e},k=function(e){if(e.code!=(new i).code)throw e;throw n.logMessage("Token refresh - Invalid session error, error added to cookie { code: "+e.code+', message: "'+e.message+'", retryAfter: '+e.retryAfter+"}"),e};i.prototype.name="InvalidSessionError",s.prototype.name="UnauthorisedError",a.prototype.name="InternalServiceError",c.prototype.name="RequestTimeoutError";var y={};return y.refreshAccessToken=o,y.setPromisePool=u,y.RETRY_AFTER_SHORT=l,y.RETRY_AFTER_LONG=36e5,y.MESSAGE_SUCCESS="bbcidv5_token_success",y.MESSAGE_ERROR="error",y.MESSAGE_INVALID="invalid",y.RETRY_AFTER_SHORT=l,y.RETRY_AFTER_LONG=36e5,y}),define("idcta-v2/idcta-1",["idcta-v2/idCookie","idcta-v2/id-config","idcta-v2/apiUtils","idcta-v2/tokenRefresh","idcta-v2/logger"],function(e,t,r,n,o){function i(t){try{this.id=t.id,this.element=document.getElementById(t.id),this.states=t.states;var r=this;h.ctas[r.id]=r,!0===t.publiclyCacheable&&(e.getInstance().hasCookie()?a(r):r.element.getElementsByTagName("span")[0].innerText=r.states.unauthorised.signedout)}catch(e){o.logCaughtError(e)}}function s(e){var t=document.querySelectorAll("#"+e),n=function(){r.appendProductToCtaElement(this)};if(t.length)for(var o=0;o<t.length;o++)for(var i=t[o].getElementsByTagName("a"),s=0;s<i.length;s++)r.addEventListenerTo(i[s],"click",n,!1)}function a(t){if(t.states.authorised){var r=e.getInstance().getNameFromCookie(),n=t.states.authorised.anonymous;r&&(n=t.states.authorised.name.replace("{name}",r)),t.element.getElementsByTagName("span")[0].innerText=n}else t.element.parentNode&&t.element.parentNode.removeChild(t.element)}function c(e,t){try{return e=!0===e,n.refreshAccessToken(e,t)}catch(e){o.logCaughtError(e)}}function u(){try{return h.initiateTokenRefresh().then(function(){return!0},function(){throw!1})}catch(e){o.logCaughtError(e)}}function g(e,t,n){try{var i=document.querySelector("#"+e+" span"),s=["small","medium","large"],a=["blue","white"];s.indexOf(t)>-1&&(i.className=i.className.replace(/small|medium|large/g,t)),a.indexOf(n)>-1&&(i.className=i.className.replace(/blue|white/g,n));var c=document.querySelectorAll("#"+e+" span a");for(var u in c)c.hasOwnProperty(u)&&r.appendProductToCtaElement(c[u])}catch(e){o.logCaughtError(e)}}function l(e,t){try{var n=document.querySelectorAll("#"+e+" a");if(!n.length)throw"No cta elements found with provided Id";for(var i in n)if(n.hasOwnProperty(i)){var s=n[i].getAttribute("href"),a=decodeURIComponent(s).match(/ptrt\=([a-zA-Z:\/\/\_\\0-9.-]*)&?/).pop();a=encodeURIComponent(a);var c=s.substring(0,s.indexOf(a)),u=s.substring(s.indexOf(a)+a.length);n[i].setAttribute("href",c+t+u),r.appendProductToCtaElement(n[i])}}catch(e){o.logCaughtError(e)}}function d(){try{var t={},r=e.getInstance();if(!r.hasCookie())return t;if(t.bbc_identity="1",!r.isPersonalisationEnabled())return t;var n=r.getHidFromCookie();return n&&(t.bbc_hid=n),t}catch(e){return o.logCaughtError(e),{}}}var h={signals:{},ctas:{}};return h.Cta=i,h.modifyCta=g,h.modifyPtrt=l,h.addUserOrigin=s,h.initiateTokenRefresh=c,h.initiateUserUplift=u,h.getIStatsLabels=d,h.hasCookie=function(){return e.getInstance().hasCookie()},h.getCookieInstance=function(){return e.getInstance()},h.getIdFromCookie=function(){return e.getInstance().getIdFromCookie()},h.getUserDetailsFromCookie=function(){return e.getInstance().getUserDetailsFromCookie()},h.getNameFromCookie=function(){return e.getInstance().getNameFromCookie()},h.getAccessToken=function(t){return e.getInstance().getAccessToken(t)},h});

//# sourceMappingURL=idcta-1.js.map
