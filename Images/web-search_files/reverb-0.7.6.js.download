!function o(s,u,n){function c(r,e){if(!u[r]){if(!s[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(d)return d(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var i=u[r]={exports:{}};s[r][0].call(i.exports,function(e){return c(s[r][1][e]||e)},i,i.exports,o,s,u,n)}return u[r].exports}for(var d="function"==typeof require&&require,e=0;e<n.length;e++)c(n[e]);return c}({1:[function(e,r,t){r.exports={name:"reverb",version:"0.7.6",smarttagVersion:"5.17.1",description:"web analytics module for BBC pages",main:"index.js",scripts:{test:"./node_modules/.bin/gulp test",build:"./node_modules/.bin/gulp default",lint:"./node_modules/.bin/gulp lint","build-dev":"./node_modules/.bin/gulp build-dev"},author:"",license:"ISC",dependencies:{},devDependencies:{"@babel/core":"^7.3.4","@babel/preset-env":"^7.3.4","@babel/register":"^7.0.0",assert:"^1.4.1",babelify:"^10.0.0",browserify:"^16.2.3","browserify-istanbul":"^3.0.1",chai:"^4.2.0","core-js":"^2.6.5",eslint:"^5.15.2","eslint-config-airbnb-base":"^13.1.0","eslint-plugin-import":"^2.16.0",gulp:"^4.0.0","gulp-babel":"^8.0.0","gulp-clean":"^0.4.0","gulp-cli":"^2.0.1","gulp-concat":"^2.6.1","gulp-eslint":"^5.0.0","gulp-js-escape":"^1.0.1","gulp-mustache":"^4.1.1","gulp-remove-lines":"^0.1.0","gulp-rename":"^1.4.0","gulp-size":"^3.0.0","gulp-template":"^5.0.0","gulp-uglify":"^3.0.2","gulp-util":"^3.0.8",karma:"^4.0.1","karma-babel-preprocessor":"^8.0.0","karma-browserify":"^6.0.0","karma-chai":"^0.1.0","karma-chrome-launcher":"^2.2.0","karma-coverage":"^1.1.2","karma-html-reporter":"^0.2.7","karma-jasmine":"^2.0.1","karma-mocha":"^1.3.0","karma-nested-reporter":"^0.1.6","karma-phantomjs-launcher":"^1.0.4","karma-requirejs":"^1.1.0","karma-sinon-chai":"^2.0.2",mocha:"^6.0.2",requirejs:"^2.3.6",sinon:"^7.2.7","sinon-chai":"^3.3.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"}}},{}],2:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Destinations=void 0;var a=e("./producers"),i={DEFAULT:{id:"596068",defaultProducer:a.Producers.BBC},ACCOUNT:{id:"598250",defaultProducer:a.Producers.ACCOUNT},ACCOUNT_TEST:{id:"598252",defaultProducer:a.Producers.ACCOUNT},BBC_SHOP:{id:"598253",defaultProducer:a.Producers.BBC_SHOP},BBC_SHOP_TEST:{id:"598254",defaultProducer:a.Producers.BBC_SHOP},BBC_THREE:{id:"598255",defaultProducer:a.Producers.BBC_THREE},BBC_THREE_TEST:{id:"598256",defaultProducer:a.Producers.BBC_THREE},BITESIZE:{id:"598257",defaultProducer:a.Producers.BITESIZE},BITESIZE_TEST:{id:"598258",defaultProducer:a.Producers.BITESIZE},BRITBOX:{id:"598259",defaultProducer:a.Producers.BRITBOX},BRITBOX_TEST:{id:"598260",defaultProducer:a.Producers.BRITBOX},CBBC:{id:"598261",defaultProducer:a.Producers.CBBC},CBBC_TEST:{id:"598262",defaultProducer:a.Producers.CBBC},CBEEBIES:{id:"598263",defaultProducer:a.Producers.CBEEBIES},CBEEBIES_TEST:{id:"598264",defaultProducer:a.Producers.CBEEBIES},FEATURE_SITES_GNL:{id:"598265",defaultProducer:a.Producers.GNL_HOMEPAGE},FEATURE_SITES_GNL_TEST:{id:"598266",defaultProducer:a.Producers.GNL_HOMEPAGE},FOOD:{id:"598267",defaultProducer:a.Producers.BBC_FOOD},FOOD_TEST:{id:"598268",defaultProducer:a.Producers.BBC_FOOD},GATEWAY:{id:"598269",defaultProducer:a.Producers.GATEWAY},GATEWAY_TEST:{id:"598270",defaultProducer:a.Producers.GATEWAY},HOMEPAGE_GNL:{id:"598271",defaultProducer:a.Producers.GNL_HOMEPAGE},HOMEPAGE_GNL_TEST:{id:"598272",defaultProducer:a.Producers.GNL_HOMEPAGE},HOMEPAGE_PS:{id:"598273",defaultProducer:a.Producers.PS_HOMEPAGE},HOMEPAGE_PS_TEST:{id:"598274",defaultProducer:a.Producers.PS_HOMEPAGE},IDEAS:{id:"598275",defaultProducer:a.Producers.BBC},IDEAS_TEST:{id:"598276",defaultProducer:a.Producers.BBC},IPLAYER:{id:"598277",defaultProducer:a.Producers.IPLAYER},IPLAYER_TEST:{id:"598278",defaultProducer:a.Producers.IPLAYER},MEDIA_ACTION:{id:"598279",defaultProducer:a.Producers.MEDIA_ACTION},MEDIA_ACTION_TEST:{id:"598280",defaultProducer:a.Producers.MEDIA_ACTION},MONITORING:{id:"598281",defaultProducer:a.Producers.MONITORING},MONITORING_TEST:{id:"598282",defaultProducer:a.Producers.MONITORING},MUSIC:{id:"598283",defaultProducer:a.Producers.BBC_MUSIC},MUSIC_TEST:{id:"598284",defaultProducer:a.Producers.BBC_MUSIC},NEWS_PS:{id:"598285",defaultProducer:a.Producers.NEWS},NEWS_PS_TEST:{id:"598286",defaultProducer:a.Producers.NEWS},NEWS_GNL:{id:"598287",defaultProducer:a.Producers.NEWS},NEWS_GNL_TEST:{id:"598288",defaultProducer:a.Producers.NEWS},NEWS_LANGUAGES_GNL:{id:"598289",defaultProducer:a.Producers.NEWS},NEWS_LANGUAGES_GNL_TEST:{id:"598290",defaultProducer:a.Producers.NEWS},NEWS_LANGUAGES_PS:{id:"598291",defaultProducer:a.Producers.NEWS},NEWS_LANGUAGES_PS_TEST:{id:"598292",defaultProducer:a.Producers.NEWS},NEWSROUND:{id:"598293",defaultProducer:a.Producers.NEWSROUND},NEWSROUND_TEST:{id:"598294",defaultProducer:a.Producers.NEWSROUND},OTHER:{id:"598295",defaultProducer:a.Producers.OTHER},OTHER_TEST:{id:"598297",defaultProducer:a.Producers.OTHER},OWN_IT:{id:"598298",defaultProducer:a.Producers.CBBC},OWN_IT_TEST:{id:"598299",defaultProducer:a.Producers.CBBC},PROGRAMMES_PS:{id:"598300",defaultProducer:a.Producers.PROGRAMMES},PROGRAMMES_PS_TEST:{id:"598301",defaultProducer:a.Producers.PROGRAMMES},SEARCH_GNL:{id:"598302",defaultProducer:a.Producers.SEARCH},SEARCH_GNL_TEST:{id:"598303",defaultProducer:a.Producers.SEARCH},SEARCH_PS:{id:"598304",defaultProducer:a.Producers.SEARCH},SEARCH_PS_TEST:{id:"598305",defaultProducer:a.Producers.SEARCH},SOUNDS:{id:"598306",defaultProducer:a.Producers.SOUNDS},SOUNDS_TEST:{id:"598307",defaultProducer:a.Producers.SOUNDS},SPORT_GNL:{id:"598308",defaultProducer:a.Producers.SPORT},SPORT_GNL_TEST:{id:"598309",defaultProducer:a.Producers.SPORT},SPORT_PS:{id:"598310",defaultProducer:a.Producers.SPORT},SPORT_PS_TEST:{id:"598311",defaultProducer:a.Producers.SPORT},STORYWORKS_GNL:{id:"598312",defaultProducer:a.Producers.GNL_STORYWORKS},STORYWORKS_GNL_TEST:{id:"598313",defaultProducer:a.Producers.GNL_STORYWORKS},SYNDICATION_PARTNERS_GNL:{id:"598314",defaultProducer:a.Producers.WS_PARTNERS_B2B},SYNDICATION_PARTNERS_GNL_TEST:{id:"598315",defaultProducer:a.Producers.WS_PARTNERS_B2B},TASTER:{id:"598316",defaultProducer:a.Producers.TASTER},TASTER_TEST:{id:"598317",defaultProducer:a.Producers.TASTER},TEACH:{id:"598318",defaultProducer:a.Producers.BBC},TEACH_TEST:{id:"598320",defaultProducer:a.Producers.BBC},VOICE:{id:"598326",defaultProducer:a.Producers.VOICE},VOICE_TEST:{id:"598328",defaultProducer:a.Producers.VOICE},WEATHER_GNL:{id:"598330",defaultProducer:a.Producers.WEATHER},WEATHER_GNL_TEST:{id:"598332",defaultProducer:a.Producers.WEATHER},WEATHER_PS:{id:"598338",defaultProducer:a.Producers.WEATHER},WEATHER_PS_TEST:{id:"598339",defaultProducer:a.Producers.WEATHER},WS_LEARNING_ENGLISH:{id:"598340",defaultProducer:a.Producers.WS_LEARNING_ENGLISH},WS_LEARNING_ENGLISH_TEST:{id:"598341",defaultProducer:a.Producers.WS_LEARNING_ENGLISH},WS_NEWS_LANGUAGES:{id:"598342",defaultProducer:a.Producers.BBC_WORLD_NEWS},WS_NEWS_LANGUAGES_TEST:{id:"598343",defaultProducer:a.Producers.BBC_WORLD_NEWS},WS_PARTNERS_B2B:{id:"598820",defaultProducer:a.Producers.WS_PARTNERS_B2B},WS_PARTNERS_B2B_TEST:{id:"598823",defaultProducer:a.Producers.WS_PARTNERS_B2B},WS_PROGRAMMES:{id:"598344",defaultProducer:a.Producers.PROGRAMMES},WS_PROGRAMMES_TEST:{id:"598345",defaultProducer:a.Producers.PROGRAMMES},WS_SYNDICATION_PARTNERS:{id:"598346",defaultProducer:a.Producers.WS_PARTNERS_B2B},WS_SYNDICATION_PARTNERS_TEST:{id:"598347",defaultProducer:a.Producers.WS_PARTNERS_B2B},GAMES_PS:{id:"599452",defaultProducer:a.Producers.BBC,isTest:!1},GAMES_PS_TEST:{id:"599454",defaultProducer:a.Producers.BBC,isTest:!0},RED_BUTTON_PS:{id:"601192",defaultProducer:a.Producers.BBC,isTest:!1},RED_BUTTON_PS_TEST:{id:"601193",defaultProducer:a.Producers.BBC,isTest:!0},BBC_SYNDICATION:{id:"601718",defaultProducer:a.Producers.BBC,isTest:!1},BBC_SYNDICATION_TEST:{id:"601719",defaultProducer:a.Producers.BBC,isTest:!0},AUDIENCE_PORTAL:{id:"602136",defaultProducer:a.Producers.AUDIENCE_SERVICES,isTest:!1},AUDIENCE_PORTAL_TEST:{id:"602137",defaultProducer:a.Producers.AUDIENCE_SERVICES,isTest:!0},AUDIENCE_SERVICES_PS:{id:"602167",defaultProducer:a.Producers.AUDIENCE_SERVICES,isTest:!1},AUDIENCE_SERVICES_PS_TEST:{id:"602168",defaultProducer:a.Producers.AUDIENCE_SERVICES,isTest:!0},get:function(e){var r;return e&&(r=this[e.toUpperCase()]),r}};t.Destinations=i},{"./producers":4}],3:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ATILabelKeys=void 0;t.ATILabelKeys={BBC_COUNTER_NAME:"name",LEVEL_1_SITE:"site",LEVEL_2_SITE:"level2",SECTION:"section",CHAPTER_1:"chapter1",CONTENT_ID:"bbc_content_id",APP_TYPE:"bbc_app_type",APP_NAME:"bbc_app_name",LANGUAGE:"language",URL:"bbc_url",REFERRER_URL:"bbc_referrer_url",CONTENT_TYPE:"bbc_content_type",LIBRARY_VERSION:"bbc_library_version",PAGE_TITLE:"page_title",CUSTOM_VAR_1:"custom_var_1",CUSTOM_VAR_2:"custom_var_2",CUSTOM_VAR_3:"custom_var_3",CUSTOM_VAR_4:"custom_var_4",CUSTOM_VAR_5:"custom_var_5",CUSTOM_VAR_6:"custom_var_6",CUSTOM_VAR_7:"custom_var_7",CUSTOM_VAR_8:"custom_var_8",CUSTOM_VAR_9:"custom_var_9",CUSTOM_VAR_10:"custom_var_10",SOURCE:"source",CONTAINER:"container",METADATA:"metadata",PERSONALISATION:"personalisation",RESULT:"result"}},{}],4:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Producers=void 0;t.Producers={ACCOUNT:1,AFAAN_OROMOO:2,AFRIQUE:3,AMHARIC:4,ARABIC:5,AZERI:6,BBC:7,BBC_ALBA:8,BBC_ARTS:9,BBC_ASIAN_NETWORK:10,BBC_FOOD:11,BBC_FOUR:12,BBC_HD:13,BBC_MUSIC:14,BBC_NEWS_CHANNEL:15,BBC_ONE:16,BBC_PARLIAMENT_CHANNEL:17,BBC_RADIO:18,BBC_RADIO_1:19,BBC_RADIO_1XTRA:20,BBC_RADIO_2:21,BBC_RADIO_3:22,BBC_RADIO_4:23,BBC_RADIO_4_EXTRA:24,BBC_RADIO_5_LIVE:25,BBC_RADIO_6_MUSIC:26,BBC_SHOP:27,BBC_THREE:28,BBC_TWO:29,BBC_WORLD_NEWS:30,BENGALI:31,BITESIZE:32,BRASIL:33,BRITBOX:34,BURMESE:35,CBBC:36,CBEEBIES:37,CHINESE:38,ENGLISH_REGIONS:39,GAHUZA:40,GATEWAY:41,GNL_AUTOS:42,GNL_CAPITAL:43,GNL_CULTURE:44,GNL_EARTH:45,GNL_FUTURE:46,GNL_HOMEPAGE:47,GNL_STORYWORKS:48,GNL_TRAVEL:49,GUJARATI:50,HAUSA:51,HINDI:52,IGBO:53,INDONESIAN:54,IPLAYER:55,JAPANESE:56,KOREAN:57,KYRGYZ:58,MARATHI:59,MEDIA_ACTION:60,MONITORING:61,MUNDO:62,NEPALI:63,NEWS:64,NEWSROUND:65,NORTHERN_IRELAND:66,OTHER:67,PASHTO:68,PERSIAN:69,PIDGIN:70,PROGRAMMES:71,PS_HOMEPAGE:72,PUNJABI:73,REEL:74,RUSSIAN:75,S4C:76,SCHOOL_RADIO:77,SCHOOL_REPORT:78,SCOTLAND:79,SEARCH:80,SERBIAN:81,SINHALA:82,SOMALI:83,SOUNDS:84,SPORT:85,SWAHILI:86,TAMIL:87,TASTER:88,TELUGU:89,THAI:90,TIGRINYA:91,TURKISH:92,UK_CHINA:93,UKRAINIAN:94,URDU:95,UZBEK:96,VIETNAMESE:97,VOICE:98,VOICE_FIRST_FORMATS:99,WALES:100,WEATHER:101,WEATHER_WATCHERS:102,WORLD_SERVICE_ENGLISH:103,WORKLIFE:104,WS_LEARNING_ENGLISH:105,WS_PARTNERS_B2B:106,YORUBA:107,NEWS_ENGLISH_REGIONS:108,SPORT_ENGLISH_REGIONS:109,NEWS_SCOTLAND:110,SPORT_SCOTLAND:111,NEWS_WALES:112,SPORT_WALES:113,NEWS_NORTHERN_IRELAND:114,SPORT_NORTHERN_IRELAND:115,AUDIENCE_SERVICES:116,WORLD_NEWS_PROGRAMMES:117,getId:function(e){var r;return e&&(r=this[e.toUpperCase()]),r}}},{}],5:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomVariables=void 0;var a,i=e("../package.json"),s=e("./util/label-cleanser"),o=e("./config/label-keys");function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var n="bbc_website",c=(u(a={},o.ATILabelKeys.CONTENT_ID,1),u(a,o.ATILabelKeys.APP_TYPE,2),u(a,o.ATILabelKeys.APP_NAME,3),u(a,o.ATILabelKeys.LANGUAGE,4),u(a,o.ATILabelKeys.URL,5),u(a,o.ATILabelKeys.REFERRER_URL,6),u(a,o.ATILabelKeys.CONTENT_TYPE,7),u(a,o.ATILabelKeys.LIBRARY_VERSION,8),u(a,o.ATILabelKeys.PAGE_TITLE,9),u(a,o.ATILabelKeys.CUSTOM_VAR_1,11),u(a,o.ATILabelKeys.CUSTOM_VAR_2,12),u(a,o.ATILabelKeys.CUSTOM_VAR_3,13),u(a,o.ATILabelKeys.CUSTOM_VAR_4,14),u(a,o.ATILabelKeys.CUSTOM_VAR_5,15),u(a,o.ATILabelKeys.CUSTOM_VAR_6,16),u(a,o.ATILabelKeys.CUSTOM_VAR_7,17),u(a,o.ATILabelKeys.CUSTOM_VAR_8,18),u(a,o.ATILabelKeys.CUSTOM_VAR_9,19),u(a,o.ATILabelKeys.CUSTOM_VAR_10,20),u(a,"create",function(r,e,t){var a,i=this;return a=this._setCustomVariable(a,o.ATILabelKeys.APP_TYPE,"responsive"),a=this._setCustomVariable(a,o.ATILabelKeys.APP_NAME,this._getAppName(null,n)),a=this._setCustomVariable(a,o.ATILabelKeys.LIBRARY_VERSION,this.getLibraryVersion()),e&&(a=this._setOrbitCustomVariables(a,e)),t&&(a=this._setDocumentCustomVariables(a,t)),r&&Object.keys(r).forEach(function(e){i._isCustomVariable(e)&&(a=i._setCustomVariable(a,e,r[e]),delete r[e])},this),a}),u(a,"_initialise",function(){return{site:{}}}),u(a,"_getAppName",function(e,r){return e&&r?"".concat(e,"-").concat(r):e?"".concat(e,"-").concat(n):r||n}),u(a,"getLibraryVersion",function(){return"".concat(i.name,"-").concat(i.version)}),u(a,"_isCustomVariable",function(e){return void 0!==this[e]&&this.hasOwnProperty(e)&&"function"!=typeof this[e]}),u(a,"_setCustomVariable",function(e,r,t){if(t){e||(e=this._initialise());var a=s.LabelCleanser.removeSensitiveInfo(t),i=s.LabelCleanser.cleanCustomVariable(a),o=this[r];e.site[o]="["+encodeURIComponent(i)+"]"}return e}),u(a,"_setDocumentCustomVariables",function(e,r){return r&&(e=this._setCustomVariable(e,o.ATILabelKeys.URL,r.URL),e=this._setCustomVariable(e,o.ATILabelKeys.REFERRER_URL,r.referrer),e=this._setCustomVariable(e,o.ATILabelKeys.PAGE_TITLE,r.title)),e}),u(a,"_setOrbitCustomVariables",function(e,r){return r&&(e=this._setCustomVariable(e,o.ATILabelKeys.CONTENT_ID,r.contentId),e=this._setCustomVariable(e,o.ATILabelKeys.CONTENT_TYPE,r.contentType),e=this._setCustomVariable(e,o.ATILabelKeys.LANGUAGE,r.language),e=this._setProductCustomVariables(e,r.additionalProperties)),e}),u(a,"_setProductCustomVariables",function(e,r){return r&&(e=this._setCustomVariable(e,o.ATILabelKeys.APP_TYPE,r.app_type),e=this._setCustomVariable(e,o.ATILabelKeys.APP_NAME,this._getAppName(r.app_category,r.app_name)),r.content_language&&(e=this._setCustomVariable(e,o.ATILabelKeys.LANGUAGE,r.content_language)),r.referrer_url&&(e=this._setCustomVariable(e,o.ATILabelKeys.REFERRER_URL,r.referrer_url)),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_1,r.custom_var_1),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_2,r.custom_var_2),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_3,r.custom_var_3),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_4,r.custom_var_4),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_5,r.custom_var_5),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_6,r.custom_var_6),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_7,r.custom_var_7),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_8,r.custom_var_8),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_9,r.custom_var_9),e=this._setCustomVariable(e,o.ATILabelKeys.CUSTOM_VAR_10,r.custom_var_10)),e}),a);t.CustomVariables=c},{"../package.json":1,"./config/label-keys":3,"./util/label-cleanser":9}],6:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReverbClient=void 0;var l=e("./config/label-keys"),s=e("./util/label-cleanser"),i=e("./custom-variables"),o=e("./config/destinations"),u=e("./config/producers"),n=e("./util/orbit-variables"),_=e("./user-action-event");function c(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var a=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.counterName="",this.tag,this.ready=!1,this.useATI=!0,this.pageValues={},this.customParams={},this.echoDeviceId=null,this.bbcHid,this.signedIn=!1,this.atiInitPromise=null,this.echoDeviceIdCookie="ckns_echo_device_id"}var r,t,a;return r=e,(t=[{key:"_readCookie",value:function(e){var r=document.cookie.split(";");if(r)for(var t=0;t<r.length;t++){var a=r[t];if(0===(a=a.trim()).indexOf(e+"=")){var i=a.split("=");if(1<i.length)return encodeURIComponent(i[1])}}return null}},{key:"_setPageValues",value:function(){var a=this;return n.OrbitVariables.getPageVariables().then(function(e){if(e){a.setDestination(e.destination),e.producer&&a.setProducer(e.producer),e.name&&a.setPageName(e.name),a.addLabel(l.ATILabelKeys.BBC_COUNTER_NAME,e&&e.name?e.name:a.counterName);var r=i.CustomVariables.create(void 0,e,document),t=a.pageValues;e&&e[l.ATILabelKeys.SECTION]&&(t[l.ATILabelKeys.CHAPTER_1]=s.LabelCleanser.cleanCustomVariable(e[l.ATILabelKeys.SECTION])),r&&a.tag.customVars.set(r),a.tag.page.set(t)}})}},{key:"_setUserValues",value:function(){var r=this;return n.OrbitVariables.getUserVariables().then(function(e){e&&(e.hashedId&&e.isSignedIn?r.bbcHid=encodeURIComponent(e.hashedId):e.isSignedIn?r.bbcHid="unidentified-user":r.bbcHid=null,r.signedIn=e.isSignedIn,r.bbcHid?r._setTagHid(r.bbcHid):r._removeTagHid())})}},{key:"_getCookieDomain",value:function(e){return e&&e.location&&e.location.hostname&&e.location.hostname.match(/.bbc.com$/)?"bbc.com":"bbc.co.uk"}},{key:"_initialiseATI",value:function(a){var i=this;return this.atiInitPromise||(this.atiInitPromise=new Promise(function(e){var r=i;a?window.ATInternet={onTrackerLoad:function(){r.tagLoaded(a.atiOpts).then(function(){e()})}}:e();var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://mybbc-analytics.files.bbci.co.uk/reverb-client-js/smarttag-5.17.1.min.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]||document.getElementsByTagName("script")[0].parentNode).insertBefore(t,null)})),this.atiInitPromise}},{key:"_createTag",value:function(e){var t=this;this.tag=new ATInternet.Tracker.Tag(e),this.tag.builder.atiSendUrl=this.tag.builder.sendUrl,this.tag.builder.sendUrl=function(e){var r=s.LabelCleanser.removeSensitiveInfo(e);t.tag.builder.atiSendUrl(r)}}},{key:"_removeTagHid",value:function(){this.tag&&this.tag.delParam("at")}},{key:"_setTagHid",value:function(e){this.tag&&this.tag.setParam("at",e)}},{key:"_setTagDeviceId",value:function(e){this.tag&&this.tag.setParam("idclient",e)}},{key:"invoke",value:function(e){return this.isReady()?Promise.resolve(this.tag):(this.echoDeviceId=this._readCookie(this.echoDeviceIdCookie),e||(e={trackUser:!1}),!1===e.useATI&&(this.useATI=!1),this.useATI?this._initialiseATI(e):(this.ready=!0,void this.contentLoaded()))}},{key:"tagLoaded",value:function(e){var r=this;return e instanceof Object||(e={}),e.secure=!0,e.cookieDomain=this._getCookieDomain(window),this._createTag(e),this.echoDeviceId&&this._setTagDeviceId(this.echoDeviceId),this.contentLoaded(),this.trackPage().then(function(){return r.ready=!0,r.tag})}},{key:"isReady",value:function(){return this.ready}},{key:"trackPage",value:function(){var r=this;return new Promise(function(e){r.useATI?Promise.all([r._setUserValues(),r._setPageValues()]).then(function(){r.tag.dispatch(),e()}):e()})}},{key:"userActionEvent",value:function(o,s,u,n,c){var d=this;return new Promise(function(e){if(d.useATI&&d.isReady()){var r=u||{},t=new _.UserActionEvent(d.tag),a={};for(var i in r)r.hasOwnProperty(i)&&(a[i]=r[i]);a.actionName=s,a.actionType=o,a.userId=d.bbcHid,a[l.ATILabelKeys.BBC_COUNTER_NAME]=d.pageName,n&&c?(a.originalEvent=c,a.anchorElement=n,t.sendClickEvent(a)):t.sendImpressionEvent(a)}e()})}},{key:"setCounterName",value:function(e){this.counterName=s.LabelCleanser.cleanPageName(e)}},{key:"getCounterName",value:function(){return this.counterName}},{key:"generateCounterName",value:function(){var e=new RegExp(/\/$/),r=new RegExp(/^\//),t=new RegExp(/\//g),a=window.location.pathname.replace(r,"").replace(e,"").replace(t,".");if(""===a){var i=new RegExp(/ \- /),o=new RegExp(/BBC /gi);a=document.title.replace(i,"").replace(o,"")}return s.LabelCleanser.cleanPageName(a)}},{key:"contentLoaded",value:function(){""===this.counterName&&this.setCounterName(this.generateCounterName())}},{key:"getSiteId",value:function(){return String(this.tag.getConfig(l.ATILabelKeys.LEVEL_1_SITE))}},{key:"addLabel",value:function(e,r){e===l.ATILabelKeys.BBC_COUNTER_NAME||e===l.ATILabelKeys.LEVEL_2_SITE?this.pageValues[e]=r:this.customParams[e]=s.LabelCleanser.cleanCustomVariable(r)}},{key:"setDestination",value:function(e){var r=o.Destinations.get(e);return r&&(this.addLabel(l.ATILabelKeys.LEVEL_2_SITE,r.defaultProducer),this.tag.setConfig(l.ATILabelKeys.LEVEL_1_SITE,r.id),e.toUpperCase().match(/TEST$/)||"DEFAULT"===e.toUpperCase()||(this.tag.setConfig("collectDomain","a1.api.BBC.co.uk"),this.tag.setConfig("collectDomainSSL","a1.api.BBC.co.uk"))),this}},{key:"setProducer",value:function(e){var r;return((r=e&&""!==e?u.Producers.getId(e):0)||0===r)&&this.addLabel(l.ATILabelKeys.LEVEL_2_SITE,r),this}},{key:"setPageName",value:function(e){this.pageName=e}},{key:"getProperties",value:function(){return{bbcHid:this.bbcHid,signedIn:this.signedIn}}}])&&c(r.prototype,t),a&&c(r,a),e}();t.ReverbClient=a},{"./config/destinations":2,"./config/label-keys":3,"./config/producers":4,"./custom-variables":5,"./user-action-event":8,"./util/label-cleanser":9,"./util/orbit-variables":10}],7:[function(e,r,t){"use strict";var a=e("./reverb-client");define("reverb",[],function(){return new a.ReverbClient})},{"./reverb-client":6}],8:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserActionEvent=void 0;var i=e("./config/label-keys");function o(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var s={ACTION_NAME:"unknown",COMPAIGN_ID:"Page",VARIANT:{},FORMAT:{},GENERAL_PLACEMENT:"unknown",DETAILED_PLACEMENT:"0",ADVERTISER_ID:"",URL:"unknown"},u="click",n="impression",a=function(){function r(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),this._tag=e}var e,t,a;return e=r,(t=[{key:"_buildCreation",value:function(e){var r=e&&e.actionName||s.ACTION_NAME;return e&&e.actionType&&(r+="~"+e.actionType),r}},{key:"_formatEventValue",value:function(e){return"["+encodeURIComponent(e.replace("&","$"))+"]"}},{key:"_serializeObjectForAti",value:function(a){return Object.keys(a).map(function(e){var r="".concat(e,"="),t=a[e];return null!=t&&(r+=t),r}).join("~")}},{key:"_sendEvent",value:function(e,r){var t={creation:this._formatEventValue(this._buildCreation(e)),campaignId:this._formatEventValue(e[i.ATILabelKeys.CONTAINER]||s.COMPAIGN_ID),variant:this._formatEventValue(this._serializeObjectForAti(e[i.ATILabelKeys.PERSONALISATION]||s.VARIANT)),format:this._formatEventValue(this._serializeObjectForAti(e[i.ATILabelKeys.METADATA]||s.FORMAT)),generalPlacement:this._formatEventValue(e[i.ATILabelKeys.BBC_COUNTER_NAME]||s.GENERAL_PLACEMENT),detailedPlacement:this._formatEventValue(e.userId||s.DETAILED_PLACEMENT),advertiserId:this._formatEventValue(e[i.ATILabelKeys.SOURCE]||s.ADVERTISER_ID),url:this._formatEventValue(e[i.ATILabelKeys.RESULT]||s.URL)},a={};r===u?(a.click=t,a.elem=e.anchorElement,a.event=e.originalEvent):a.impression=t,this._tag&&this._tag.publisher.send(a)}},{key:"sendClickEvent",value:function(e){this._sendEvent(e,u)}},{key:"sendImpressionEvent",value:function(e){this._sendEvent(e,n)}}])&&o(e.prototype,t),a&&o(e,a),r}();t.UserActionEvent=a},{"./config/label-keys":3}],9:[function(e,r,t){"use strict";function i(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.LabelCleanser=void 0;var a=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,t,a;return r=e,a=[{key:"cleanPageName",value:function(e){var r=new RegExp(/[^a-z0-9\.]+/g),t=new RegExp(/\.+/g),a=new RegExp(/(^_+)|(_+$)/g),i=e&&e.toLowerCase().replace(r,"_").replace(t,".").replace(a,"")||"no.name.page";if(e!==i&&("string"!=typeof e||0===e.replace(/ */,"").length))throw new Error("REVERB-ERROR: Countername must be a non-empty string");return-1===i.search(/\.page$/)&&(i+=".page"),i}},{key:"cleanCustomVariable",value:function(e){return e&&e.trim().replace(/\[|\]/g,"").replace(/&/g,"$").replace(/\s{1,}/g," ")}},{key:"removeSensitiveInfo",value:function(e){if(e&&"string"==typeof e)for(var r=0;r<this.sensitiveParams.length;r++){var t=this.sensitiveParams[r],a=new RegExp("".concat(t,"=[^&]*"),"g");e=e.replace(a,"".concat(t,"=XXXX"))}return e}}],(t=null)&&i(r.prototype,t),a&&i(r,a),e}();(t.LabelCleanser=a).sensitiveParams=["token","guardianToken","nonce","dateOfBirthDay","dateOfBirthMonth","dateOfBirthYear","dateOfBirth","permissionToken"]},{}],10:[function(e,r,t){"use strict";function i(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.OrbitVariables=void 0;var a=function(){function r(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r)}var e,t,a;return e=r,a=[{key:"wrapMethod",value:function(e,r){return e[r]&&"function"==typeof e[r]?e[r]():Promise.resolve(null)}},{key:"getPageVariables",value:function(){return window&&window.bbcpage?Promise.all(["getName","getDestination","getProducer","getSection","getContentId","getContentType","getLanguage","getAdditionalProperties"].map(function(e){return r.wrapMethod(window.bbcpage,e)})).then(function(e){return{name:e[0],destination:e[1],producer:e[2],section:e[3],contentId:e[4],contentType:e[5],language:e[6],additionalProperties:e[7]}}):Promise.resolve(void 0)}},{key:"getUserVariables",value:function(){return window&&window.bbcuser?Promise.all(["getHashedId","isSignedIn"].map(function(e){return r.wrapMethod(window.bbcuser,e)})).then(function(e){return{hashedId:e[0],isSignedIn:e[1]}}):Promise.resolve(void 0)}}],(t=null)&&i(e.prototype,t),a&&i(e,a),r}();t.OrbitVariables=a},{}]},{},[7]);